<!DOCTYPE html>
<html>
<head>
<script src="http://code.jquery.com/jquery.min.js" ></script>

<script type="text/javascript">
//UI event binding to buttons
$(function() {
		//translation button
		$('#translation').click(function(){		 
			$('#res1').html('<b>Translation in progress...</b>');
			$('#res2').text('');
			
			Tilde.eTranslate(
				$('#text').val(),
				'en', 
				'de', 
				function(result){
					$('#res1').text(result);
				},
				function(status, response){
					$('#res1').text(status);
					$('#res2').text(response);
				}
			);
		});
		
		//terminology button
		$('#terminology').click(function(){		 
			$('#res1').html('<b>Terminology enrichment in progress...</b>');
			$('#res2').text('');
			
			Tilde.eTerminology(
				$('#text').val(), 
				'en',
				'de',
				'',
				function(result){
					$('#res1').text(result.its);
					$('#res2').text(result.tbx);
				},
			    function(ex){
					$('#res1').text(ex.statusText);
					$('#res2').text(ex.responseText);
					console.log(ex.responseText);
				}
			);
		});		
		
		/* parameters for Tilde.eTerminology
				$('#text').val(),				text to be enriched
				'en',  			  				source language
				'de', 							target Language
				'',             				optional domain code, format e.g TaaS-2011. see https://term.tilde.com/domains
				function(result){},	            callback on success	
				function(ex){} 			        callback on error
		*/
		/* parameters for Tilde.eTranslate
				$('#text').val(),				text to be translated
				'en',  			  				source language
				'de', 							target Language			
				function(result){},	            callback on success		
				function(ex){} 			        callback on error				
		*/
});
</script>

<script type="text/javascript">
	// e-translation method
 
	if (typeof (Tilde) === 'undefined') Tilde = {};		

	Tilde.eTranslate=function(text, sourceLang, targetLang, success, error){				
		Tilde.Translator.getSystem(sourceLang, targetLang,  
			function(system){
				if (system === undefined) {			
					error("Translation not started", "No system available for selected language pair");
				}
				else{
				Tilde.Translator.translate(text, system, success, error);
			};
		}, error);		
	};

	// e-terminology method
	Tilde.eTerminology=function(text, sourceLang, targetLang, domain, success,error){
		Tilde.Terminology.lookup(text, sourceLang, targetLang, domain, success, error);		
	};	
 </script>
 
<script type="text/javascript">
	// Tilde translator connector
	Tilde.Translator={};	
	Tilde.Translator.clientid='u-bd13faca-b816-4085-95d5-05373d695ab7';
	Tilde.Translator.appid='freme';
	Tilde.Translator.url='https://letsmt.eu/ws/Service.svc/json/';
	
	Tilde.Translator.systems=[];
	Tilde.Translator.getSystem=function(sourceLang, targetLang, callback, error){	
		if (Tilde.Translator.systems.length==0){					
				$.ajax(
					{
						type:'GET',
						dataType: 'json',
						url: Tilde.Translator.url+'GetSystemList', 
						data: { appid: Tilde.Translator.appid},
						cache: false,
						headers: { 'client-id': Tilde.Translator.clientid}
					})
					.done(function (data) { 
					  console.log(data);
						$.each(data.System, function (idx, sys) {
							var status = Tilde.Translator.getSystemMetaValue(sys.Metadata, 'status');						
							if (status === 'running') {
								Tilde.Translator.systems.push(sys);
							}
						});	
						callback(Tilde.Translator.filteredSystem(sourceLang, targetLang));
					  })				 
					 .fail(function (ex) {						
						error(ex.statusText, ex.responseText);
					  })					 
			}
			else
			{
				callback(Tilde.Translator.filteredSystem(sourceLang, targetLang));
			}
	};
	Tilde.Translator.filteredSystem=function(sourceLang, targetLang){
		var filteredSystems=[];
		$.each(Tilde.Translator.systems, function (idx, sys) {								
			if (sys.SourceLanguage.Code === sourceLang && sys.TargetLanguage.Code===targetLang) {
				filteredSystems.push(sys);
			}
		});	
		console.log(filteredSystems[0]);
		return filteredSystems[0];
	};
	Tilde.Translator.getSystemMetaValue=function(array, key) {
        if (array === undefined) {
            return false;
        }
        var value = null;
        $.each(array, function (idx, item) {
            if (item.Key === key) {
                value = item.Value;
                return false; //breaks the loop
            }
        });
        return value;
    }	
	Tilde.Translator.translate=function(text, system, success, error)	{
		$.ajax(
		{
			type:'GET',
			dataType: 'json',
			url: Tilde.Translator.url+'Translate', 
			data: { 
				appid: Tilde.Translator.appid,
				systemid: system.ID,
				text: text
				},
			cache: false,
			headers: { 'client-id': Tilde.Translator.clientid}
		})
		 .done(function (data) { 								
			success(data);
		  })				 
		 .fail(function (ex) {		
			error(ex.statusText, ex.responseText);
		  });
	}
</script>

<script type="text/javascript">	  	
	//Tilde terminology connector
	Tilde.Terminology={};	
	Tilde.Terminology.clientid='RlJFTUU6dXxGcjNtM19zJGN1ciQ=';
	Tilde.Terminology.url='https://api.taas-project.eu/extraction/demo?';
	
	Tilde.Terminology.lookup=function(text, sourceLang, targetLang, domain, success, error){
		$.ajax(
			{
				type:'POST',
				url: Tilde.Terminology.url+'sourceLang='+sourceLang+'&targetLang='+targetLang+'&domain='+domain,
				data: text,
				cache: false,
				headers: { 'content-type': 'text/plain', 'Authorization': 'basic '+ Tilde.Terminology.clientid, 'TaaS-User-Key':''}
			})
			.done(function (result) {  		
				success(result);
			  })
			 .fail(function (data) {					
				console.log("error in terminology");			
				error(data);				
			  });
	}	
</script>

</head>
<body>

<div id="input" style="width:48%;float:left;">
<textarea id="text" maxlength="200" rows="4" style="width:100%;" placeholder="Enter text"></textarea>
<div style="clear:both;">
<button id="terminology" type="button">Terminologyse</button>
<button id="translation" type="button">Translate</button>
</div>
</div>

<div id="output" style="width:48%;float:right;">
	<div id="res1"></div>
	<hr/>
	<div id="res2"></div>
</div>

</body>
</html>